<Page x:Class="FftDataAnalyzer.Views.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:FftDataAnalyzer.ViewModels"
      Background="{StaticResource PrimaryBackgroundBrush}">

    <Page.DataContext>
        <vm:HomeViewModel/>
    </Page.DataContext>

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title and Actions -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="FFT Records"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="{StaticResource PrimaryTextBrush}"/>

            <Button Grid.Column="1"
                    Content="ðŸ”„ Refresh"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding RefreshCommand}"
                    Padding="12,8"/>
        </Grid>

        <!-- Search Bar -->
        <Border Grid.Row="1"
                Background="{StaticResource TertiaryBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="15"
                Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         Style="{StaticResource ModernTextBox}"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         FontSize="14"
                         Margin="0,0,10,0">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Return" Command="{Binding SearchCommand}"/>
                    </TextBox.InputBindings>
                </TextBox>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="ðŸ”"
                               FontSize="16"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource SecondaryTextBrush}"
                               Margin="10,0"/>
                    <TextBlock Text="Search by name or filename"
                               FontSize="12"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource SecondaryTextBrush}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Data Grid -->
        <Border Grid.Row="2"
                Background="{StaticResource TertiaryBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4">
            <DataGrid ItemsSource="{Binding FftRecords}"
                      SelectedItem="{Binding SelectedRecord}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      Background="{StaticResource TertiaryBackgroundBrush}"
                      Foreground="{StaticResource PrimaryTextBrush}"
                      BorderThickness="0"
                      RowBackground="{StaticResource TertiaryBackgroundBrush}"
                      AlternatingRowBackground="{StaticResource SecondaryBackgroundBrush}"
                      FontSize="13"
                      RowHeight="45">

                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="{StaticResource SecondaryBackgroundBrush}"/>
                        <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="13"/>
                        <Setter Property="Padding" Value="12,10"/>
                        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                        <Setter Property="HorizontalContentAlignment" Value="Left"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Padding" Value="12,8"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="VerticalAlignment" Value="Center"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridCell">
                                    <Border Padding="{TemplateBinding Padding}"
                                            Background="{TemplateBinding Background}">
                                        <ContentPresenter VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.CellStyle>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Display Name"
                                        Binding="{Binding DisplayName}"
                                        Width="2*"
                                        MinWidth="180">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Created At"
                                        Binding="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                                        Width="140">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Sample Rate (Hz)"
                                        Binding="{Binding SampleRate, StringFormat='{}{0:N0}'}"
                                        Width="130">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Sample Count"
                                        Binding="{Binding SampleCount, StringFormat='{}{0:N0}'}"
                                        Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Peak Freq (Hz)"
                                        Binding="{Binding PeakFrequency, StringFormat='{}{0:F2}'}"
                                        Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding Status}"
                                        Width="90">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="Actions" Width="170">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center">
                                    <Button Content="View"
                                            Style="{StaticResource PrimaryButton}"
                                            Command="{Binding DataContext.ViewRecordCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                            CommandParameter="{Binding}"
                                            Padding="10,5"
                                            FontSize="12"
                                            MinWidth="60"
                                            Margin="0,0,5,0"/>
                                    <Button Content="Delete"
                                            Style="{StaticResource SecondaryButton}"
                                            Command="{Binding DataContext.DeleteRecordCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                            CommandParameter="{Binding}"
                                            Padding="10,5"
                                            FontSize="12"
                                            MinWidth="60"
                                            Foreground="{StaticResource ErrorBrush}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="3"
                Background="{StaticResource SecondaryBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="15,10"
                Margin="0,10,0,0">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="{StaticResource SecondaryTextBrush}"
                           FontSize="12"
                           VerticalAlignment="Center"/>

                <TextBlock Text="Loading..."
                           Foreground="{StaticResource AccentBrush}"
                           FontSize="12"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>
    </Grid>
</Page>
