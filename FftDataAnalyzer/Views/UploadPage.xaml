<Page x:Class="FftDataAnalyzer.Views.UploadPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:FftDataAnalyzer.ViewModels"
      Background="{StaticResource PrimaryBackgroundBrush}"
      AllowDrop="True"
      Drop="Page_Drop">

    <Page.DataContext>
        <vm:UploadViewModel/>
    </Page.DataContext>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title -->
            <TextBlock Grid.Row="0"
                       Text="Upload FFT Data"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="{StaticResource PrimaryTextBrush}"
                       Margin="0,0,0,30"/>

            <!-- File Drop Zone -->
            <Border Grid.Row="1"
                    Background="{StaticResource TertiaryBackgroundBrush}"
                    BorderBrush="{StaticResource AccentBrush}"
                    BorderThickness="2"
                    CornerRadius="8"
                    Padding="40"
                    Margin="0,0,0,30"
                    AllowDrop="True"
                    Drop="Page_Drop">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“"
                               FontSize="48"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,15"/>

                    <TextBlock Text="Drag and drop your CSV file here"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10"/>

                    <TextBlock Text="or"
                               FontSize="14"
                               Foreground="{StaticResource SecondaryTextBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,15"/>

                    <Button Content="Browse Files"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding BrowseFileCommand}"
                            Padding="20,10"
                            FontSize="14"/>

                    <TextBlock Text="{Binding SelectedFilePath}"
                               FontSize="12"
                               Foreground="{StaticResource SuccessBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,15,0,0"
                               TextWrapping="Wrap"
                               MaxWidth="600"
                               Visibility="{Binding SelectedFilePath, Converter={StaticResource NullToVisibilityConverter}}"/>
                </StackPanel>
            </Border>

            <!-- Configuration Form -->
            <Border Grid.Row="2"
                    Background="{StaticResource TertiaryBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="30"
                    Margin="0,0,0,30">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Display Name -->
                    <TextBlock Grid.Row="0" Grid.Column="0"
                               Text="Display Name *"
                               FontSize="14"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,0,20"/>
                    <TextBox Grid.Row="0" Grid.Column="1"
                             Style="{StaticResource ModernTextBox}"
                             Text="{Binding DisplayName, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,0,20"/>

                    <!-- Sample Rate -->
                    <TextBlock Grid.Row="1" Grid.Column="0"
                               Text="Sample Rate (Hz)"
                               FontSize="14"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,0,20"/>
                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,0,20">
                        <CheckBox Content="Auto-detect from file"
                                  IsChecked="{Binding AutoDetectSampleRate}"
                                  Foreground="{StaticResource PrimaryTextBrush}"
                                  Margin="0,0,0,10"/>
                        <TextBox Style="{StaticResource ModernTextBox}"
                                 Text="{Binding SampleRate}"
                                 IsEnabled="{Binding AutoDetectSampleRate, Converter={StaticResource InverseBooleanConverter}}"
                                 Width="200"
                                 HorizontalAlignment="Left"/>
                    </StackPanel>

                    <!-- Window Type -->
                    <TextBlock Grid.Row="2" Grid.Column="0"
                               Text="Window Function"
                               FontSize="14"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,0,20"/>
                    <ComboBox Grid.Row="2" Grid.Column="1"
                              SelectedItem="{Binding WindowType}"
                              Width="200"
                              HorizontalAlignment="Left"
                              FontSize="14"
                              Margin="0,0,0,20">
                        <ComboBox.Style>
                            <Style TargetType="ComboBox">
                                <Setter Property="Background" Value="{StaticResource TertiaryBackgroundBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                                <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Padding" Value="10,8"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ComboBox">
                                            <Grid>
                                                <ToggleButton Name="ToggleButton"
                                                             Grid.Column="2"
                                                             Background="{TemplateBinding Background}"
                                                             BorderBrush="{TemplateBinding BorderBrush}"
                                                             BorderThickness="{TemplateBinding BorderThickness}"
                                                             Focusable="False"
                                                             IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                             ClickMode="Press">
                                                    <ToggleButton.Style>
                                                        <Style TargetType="ToggleButton">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="ToggleButton">
                                                                        <Border Background="{TemplateBinding Background}"
                                                                               BorderBrush="{TemplateBinding BorderBrush}"
                                                                               BorderThickness="{TemplateBinding BorderThickness}"
                                                                               CornerRadius="4">
                                                                            <Grid>
                                                                                <Grid.ColumnDefinitions>
                                                                                    <ColumnDefinition Width="*"/>
                                                                                    <ColumnDefinition Width="30"/>
                                                                                </Grid.ColumnDefinitions>
                                                                                <ContentPresenter Grid.Column="0"
                                                                                                HorizontalAlignment="Left"
                                                                                                VerticalAlignment="Center"
                                                                                                Margin="10,0,0,0"/>
                                                                                <Path Grid.Column="1"
                                                                                     HorizontalAlignment="Center"
                                                                                     VerticalAlignment="Center"
                                                                                     Data="M 0 0 L 4 4 L 8 0 Z"
                                                                                     Fill="{StaticResource PrimaryTextBrush}"/>
                                                                            </Grid>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ToggleButton.Style>
                                                </ToggleButton>
                                                <ContentPresenter Name="ContentSite"
                                                                 IsHitTestVisible="False"
                                                                 Content="{TemplateBinding SelectionBoxItem}"
                                                                 ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                                 ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                                 Margin="10,8"
                                                                 VerticalAlignment="Center"
                                                                 HorizontalAlignment="Left"/>
                                                <Popup Name="Popup"
                                                      Placement="Bottom"
                                                      IsOpen="{TemplateBinding IsDropDownOpen}"
                                                      AllowsTransparency="True"
                                                      Focusable="False"
                                                      PopupAnimation="Slide">
                                                    <Border Name="DropDownBorder"
                                                           Background="{StaticResource SecondaryBackgroundBrush}"
                                                           BorderBrush="{StaticResource BorderBrush}"
                                                           BorderThickness="1"
                                                           CornerRadius="4"
                                                           MinWidth="{TemplateBinding ActualWidth}"
                                                           MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                                        <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                                        </ScrollViewer>
                                                    </Border>
                                                </Popup>
                                            </Grid>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ComboBox.Style>
                        <ComboBox.ItemContainerStyle>
                            <Style TargetType="ComboBoxItem">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                                <Setter Property="Padding" Value="12,10"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ComboBoxItem">
                                            <Border Name="Border"
                                                   Background="{TemplateBinding Background}"
                                                   BorderThickness="{TemplateBinding BorderThickness}"
                                                   Padding="{TemplateBinding Padding}"
                                                   CornerRadius="2"
                                                   Margin="2">
                                                <ContentPresenter/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsHighlighted" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="{StaticResource AccentBrush}"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="{StaticResource AccentBrush}"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ComboBox.ItemContainerStyle>
                        <ComboBox.Items>
                            <ComboBoxItem Content="Hann" Tag="Hann"/>
                            <ComboBoxItem Content="Hamming" Tag="Hamming"/>
                            <ComboBoxItem Content="Blackman" Tag="Blackman"/>
                            <ComboBoxItem Content="None" Tag="None"/>
                        </ComboBox.Items>
                    </ComboBox>

                    <!-- Progress Bar -->
                    <ProgressBar Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                 Height="8"
                                 Value="{Binding ProgressValue}"
                                 Maximum="100"
                                 Foreground="{StaticResource AccentBrush}"
                                 Background="{StaticResource SecondaryBackgroundBrush}"
                                 Margin="0,0,0,15"
                                 Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <Button Content="Clear"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding ClearCommand}"
                                Padding="20,10"
                                Margin="0,0,10,0"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBooleanConverter}}"/>
                        <Button Content="Process File"
                                Style="{StaticResource PrimaryButton}"
                                Command="{Binding ProcessFileCommand}"
                                Padding="20,10"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBooleanConverter}}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Status Message -->
            <Border Grid.Row="3"
                    Background="{StaticResource SecondaryBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="20"
                    VerticalAlignment="Top">
                <TextBlock Text="{Binding StatusMessage}"
                           FontSize="14"
                           Foreground="{StaticResource SecondaryTextBrush}"
                           TextWrapping="Wrap"/>
            </Border>
        </Grid>
    </ScrollViewer>
</Page>
