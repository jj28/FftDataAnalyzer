<Window x:Class="FftDataAnalyzer.Views.FftDetailView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:FftDataAnalyzer.ViewModels"
        xmlns:scottplot="clr-namespace:ScottPlot;assembly=ScottPlot.WPF"
        Title="FFT Detail"
        Height="1000"
        Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource PrimaryBackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource SecondaryBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="30,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding Record.DisplayName}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               Margin="0,0,0,10"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Sample Rate: "
                                   FontSize="13"
                                   Foreground="{StaticResource SecondaryTextBrush}"/>
                        <TextBlock Text="{Binding Record.SampleRate, StringFormat='{}{0:N0} Hz'}"
                                   FontSize="13"
                                   Foreground="{StaticResource PrimaryTextBrush}"
                                   Margin="0,0,20,0"/>

                        <TextBlock Text="Samples: "
                                   FontSize="13"
                                   Foreground="{StaticResource SecondaryTextBrush}"/>
                        <TextBlock Text="{Binding Record.SampleCount, StringFormat='{}{0:N0}'}"
                                   FontSize="13"
                                   Foreground="{StaticResource PrimaryTextBrush}"
                                   Margin="0,0,20,0"/>

                        <TextBlock Text="Created: "
                                   FontSize="13"
                                   Foreground="{StaticResource SecondaryTextBrush}"/>
                        <TextBlock Text="{Binding Record.CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                                   FontSize="13"
                                   Foreground="{StaticResource PrimaryTextBrush}"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Export CSV"
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding ExportCsvCommand}"
                            Padding="12,8"
                            Margin="0,0,10,0"/>
                    <Button Content="Export PNG"
                            Style="{StaticResource SecondaryButton}"
                            Click="ExportPngButton_Click"
                            Padding="12,8"
                            Margin="0,0,10,0"/>
                    <Button Content="Close"
                            Style="{StaticResource SecondaryButton}"
                            Click="CloseButton_Click"
                            Padding="12,8"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="1*"/>
            </Grid.RowDefinitions>

            <!-- Chart Area -->
            <Border Grid.Row="0"
                    Background="{StaticResource TertiaryBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Margin="0,0,0,20">
                <Grid>
                    <!-- ScottPlot Chart -->
                    <scottplot:WpfPlot x:Name="FftChart"
                                       Margin="10"/>

                    <!-- Loading Overlay -->
                    <Border Background="#99000000"
                            Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Loading FFT data..."
                                   FontSize="18"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Border>
                </Grid>
            </Border>

            <!-- Controls -->
            <Border Grid.Row="1"
                    Background="{StaticResource SecondaryBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="15"
                    Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ’¡ Chart Controls: "
                               FontSize="12"
                               Foreground="{StaticResource SecondaryTextBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <TextBlock Text="Mouse Wheel = Zoom  |  Click+Drag = Pan  |  Double-Click = Reset"
                               FontSize="12"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- Peaks Table -->
            <Border Grid.Row="2"
                    Background="{StaticResource TertiaryBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="Peak Frequencies (Top 10)"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               Margin="15,15,15,10"/>

                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding Peaks}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              Background="{StaticResource TertiaryBackgroundBrush}"
                              Foreground="{StaticResource PrimaryTextBrush}"
                              BorderThickness="0"
                              RowBackground="{StaticResource TertiaryBackgroundBrush}"
                              AlternatingRowBackground="{StaticResource SecondaryBackgroundBrush}"
                              Margin="10">

                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="{StaticResource SecondaryBackgroundBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Padding" Value="10,8"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="#"
                                                Binding="{Binding Index}"
                                                Width="60"/>
                            <DataGridTextColumn Header="Frequency (Hz)"
                                                Binding="{Binding Frequency, StringFormat='F2'}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Amplitude"
                                                Binding="{Binding Amplitude, StringFormat='F6'}"
                                                Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource SecondaryBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="30,10">
            <TextBlock Text="{Binding StatusMessage}"
                       FontSize="12"
                       Foreground="{StaticResource SecondaryTextBrush}"/>
        </Border>
    </Grid>
</Window>
